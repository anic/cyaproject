<!DOCTYPE html>
<html lang="en">
	<head>
		<title>工具目录</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/login.js"></script>
		
		<script type="text/javascript">
			$(function() {
				// var bg = chrome.extension.getBackgroundPage();
				// $("#description").append(bg.gExInfo.description);
				
				//暂时不开启自动登录
				// window.Login.testLogin(function(result) {
					// if(result) {
						// onLoginSuccess(result);
					// } else {
						// $("#btnLogin").html("<< 请登录  >>");
					// }
				// });
				
				//屏蔽管理员菜单
				var bg = chrome.extension.getBackgroundPage();
				if(!bg.isExtensionAdmin()) {
					$(".adminMenu").hide();
				}

			});
			function menuLogin() {
				$("#btnLogin").css("color", "orange").html("登录中...");
				window.Login.testLogin(function(result) {
					if(result) {
						onLoginSuccess();
					} else {
						var bg = chrome.extension.getBackgroundPage();
						var name = bg.setting("PortalName");
						var pwd = bg.setting("PortalPwd");
						if(name && pwd) {
							window.Login.login(name, pwd, onLoginSuccess);
						} else
							$("#btnLogin").css("color", "red").html("未设置用户名密码");
					}
				})
			}

			function onLoginSuccess(result) {
				if(result) {
					$("#btnLogin").css("color", "green").html("OA已登录")[0].onclick = null;
					$("#btnLogin").append("<img src='image/popup/check.png'>");
				} else {
					$("#btnLogin").css("color", "red").html("登录失败");
				}
			}

			function openTab(url) {
				chrome.tabs.create({
					url : url
				});
			}
		</script>
	</head>
	<body style="width:150px">
		<!--
		参考：http://codecanyon.net/item/drop-menu/full_screen_preview/81289?ref=1stwebdesigner&clickthrough_id=38287307&redirect_back=true&ref=1stwebdesigner
		-->
		<ul class="nav nav-list" style="width:170px;margin-left:-20px;">
			<li class="nav-header">
				<i class="icon-user"></i>OA登录状态
			</li>
			<li>
				
				<a href="#" onclick="menuLogin()" id="btnLogin">登录</a>
			</li>
			<li>
				<a href="http://pac.gmcc.net/portal/dt?DISHI_Portal.setSelected=DISHI_guangzhou_workbench1&last=false&provider=DISHI_Portal" target="_blank">工作台</a>
			</li>
			<li class="nav-header">
				<i class="icon-book"></i>
				通讯录
			</li>
			<li class="adminMenu">
				<a href="app/contact/contact.html" target="_blank">离线通讯录</a>
			</li>
			<li class="adminMenu">
				<a href="http://contacts.services.gmcc.net/UserInfoSimple.aspx?nid=61ca46b7-0b76-41ae-9e1a-cd9adba8c86c&sid=11&f=app" target="_blank">省通讯录</a>
			</li>
			<li class="adminMenu">
				<a href="http://lsp2.gz.gmcc.net/OffCommunicate/adress.aspx" target="_blank">市通讯录</a>
			</li>
			<li class="nav-header">
				<i class="icon-cog"></i>
				设置
			</li>
			<li>
				<a href="feature.html" target="_blank">应用设置</a>
			</li>
			<li class="adminMenu">
				<a href="#" onclick="javascript:openTab('chrome://settings/extensionSettings')">Chrome</a>
			</li>
			<li class="nav-header">
				<i class="icon-plus"></i>
				其他
			</li>
			<li class="adminMenu">
				<a href="app/workreport/index.html" target="_blank">需求监控</a>
			</li>
			<li class="adminMenu">
				<a href="app/appscan/index.html" target="_blank">Query构造器</a>
			</li>
			<li class="adminMenu">
				<a href="popup.html" target="_blank">弹出</a>
			</li>
		</ul>
	</body>
</html>
