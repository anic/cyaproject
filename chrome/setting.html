<!DOCTYPE html>
<html lang="en">
	<head>
		<title>设置</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/jNice.js"></script>
		<script type="text/javascript" src="js/login.js"></script>
		<script type="text/javascript">
			$(function() {
				var bg = chrome.extension.getBackgroundPage();
				$("#txtPortalName").val(bg.setting("PortalName"));

				if(bg.isExtensionAdmin()) {
					$("#pAdminDecription").html("您已经是此应用的管理员，可以访问所有功能。");
					$("#btnDeactivateAdmin").show();
				} else {
					$("#pAdminDecription").html("您不是此应用的管理员，不可访问管理员功能。");
					$("#btnActivateAdmin").show();
				}
			});
			function activateAdmin() {
				var bg = chrome.extension.getBackgroundPage();
				//TODO:加强口令
				if(prompt("请输入管理员口令") == "gmccwebsitesucks") {
					bg.setting(bg.EXTENSION_IS_ADMIN, "true");
					alert("管理员功能开启成功");
					window.location.reload();
				} else {
					alert("管理员口令错误");
				}
			}

			function deactivateAdmin() {
				var bg = chrome.extension.getBackgroundPage();
				if(confirm("确认关闭管理员功能？")) {
					bg.setting(bg.EXTENSION_IS_ADMIN, null);
					alert("管理员功能关闭成功");
					window.location.reload();
				}
			}

			function savePortal() {
				var portalName = $("#txtPortalName").val();
				var portalPwd = $("#txtPortalPwd").val();
				var bg = chrome.extension.getBackgroundPage();
				bg.setting("PortalName", portalName);
				bg.setting("PortalPwd", portalPwd);
				alert("保存成功");
			}

			function settingLogin() {
				var bg = chrome.extension.getBackgroundPage();
				var name = bg.setting("PortalName");
				var pwd = bg.setting("PortalPwd");

				var loginUrl = window.Login.buildUrl(name, pwd);
				window.open(loginUrl);
			}

			function buildUrl() {
				var bg = chrome.extension.getBackgroundPage();
				var name = bg.setting("PortalName");
				var pwd = bg.setting("PortalPwd");

				var loginUrl = window.Login.buildUrl(name, pwd);
				alert(loginUrl);
			}
		</script>
	</head>
	<body>
		<div class="navbar">
			<div class="navbar-inner">
				<div class="container">
					<a class="brand" href="#"> GmccOffice </a>
					<ul class="nav">
						<li>
							<a href="feature.html">首页</a>
						</li>
						<li class="active">
							<a href="#">设置</a>
						</li>
						<li>
							<a href="#">帮助</a>
						</li>
						<li>
							<a href="others.html">其他</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="container">
			<form class="form-horizontal">
				<fieldset>
					<legend>
						Portal
					</legend>
					<div class="control-group">
						<label class="control-label" for="input01">用户名</label>
						<div class="controls">
							<input type="text" class="input-xlarge" id="txtPortalName">
							<p>
								设置Portal的用户名和密码，以便应用自动登录Portal
							</p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="input01">密码</label>
						<div class="controls">
							<input type="password" class="input-xlarge" id="txtPortalPwd"  placeholder="***">
						</div>
					</div>
					<div class="form-actions">
						<button id="btnSave" class="btn btn-primary" name="" onclick="savePortal();">
							保存
						</button>
						<button class="btn" onclick="settingLogin()" >
							测试登录
						</button>
						<button class="btn" onclick="buildUrl()" >
							登录链接
						</button>
					</div>
				</fieldset>
			</form>
			<form class="form-horizontal">
				<fieldset>
					<legend>
						应用管理
					</legend>
					<div class="control-group">
						<label class="control-label" for="input01"></label>
						<div class="controls">
							<p id="pAdminDecription"></p>
						</div>
					</div>
					<div class="form-actions">
						<button id="btnActivateAdmin" name="" onclick="activateAdmin();" class="btn btn-success" style="display: none;">
							开启管理员功能
						</button>
						<button id="btnDeactivateAdmin" name="" onclick="deactivateAdmin();" class="btn btn-warning" style="display: none;">
							关闭管理员功能
						</button>
					</div>
				</fieldset>
			</form>
		</div>
	</body>
</html>
